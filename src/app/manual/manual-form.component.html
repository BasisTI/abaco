<div class="ui-g ui-fluid">
  <div class="ui-g-12">
    <div class="card card-w-title">
      <h1>{{ manual.id ? 'Editar Manual' : 'Cadastrar Manual' }}</h1>
      <form name="editForm" role="form" novalidate (ngSubmit)="save(editForm)" #editForm="ngForm">
        
        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12" 
            [hidden]="!manual.id" 
            style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input type="text" class="ui-inputtext" name="id" pInputText [(ngModel)]="manual.id" readonly/>
              <label>ID</label>
            </span>
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input
                id="nome_manual"
                type="text" 
                name="nome"
                maxlength="250"
                [(ngModel)]="manual.nome" 
                pInputText
                #nome='ngModel'
                required/>
              <label>{{ 'Nome *' | translate }}</label>
              <div *ngIf="editForm.controls['nome'] 
                && !editForm.controls['nome'].valid 
                && (editForm.controls['nome'].touched 
                || editForm.submitted)" 
                class="ui-message ui-messages-error">
                Campo obrigatório.
              </div>
            </span>

          </div>

          <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input 
                required
                type="text" 
                maxlength="3"
                name="valorVariacaoEstimada"
                [(ngModel)]="manual.valorVariacaoEstimadaFormatado"
                #valorVariacaoEstimada='ngModel'
                pInputText/>
              <label>Valor Variacao Estimada (%) *</label>
              <div *ngIf="editForm.controls['valorVariacaoEstimada'] 
                && !editForm.controls['valorVariacaoEstimada'].valid 
                && (editForm.controls['valorVariacaoEstimada'].touched 
                || editForm.submitted)" 
                class="ui-message ui-messages-error">
                Campo obrigatório.
              </div>
            </span>
          </div>

          <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input 
                required
                type="text" 
                maxlength="3"
                name="valorVariacaoIndicativa"
                #valorVariacaoIndicativa='ngModel'
                [(ngModel)]="manual.valorVariacaoIndicativaFormatado"
                pInputText/>
              <label>Valor Variação Indicativa (%) *</label>
              <div *ngIf="editForm.controls['valorVariacaoIndicativa'] 
                && !editForm.controls['valorVariacaoIndicativa'].valid 
                && (editForm.controls['valorVariacaoIndicativa'].touched 
                || editForm.submitted)" 
                class="ui-message ui-messages-error">
                Campo obrigatório.
              </div>
            </span>
          </div>

        </div>

        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12">
            <label>Observação</label>
          </div>
          
          <div class="ui-g-12 ui-md-12 ui-sm-12" style="margin-bottom: 25px">
            <textarea 
              class="ui-g-12 ui-md-12 ui-sm-12"
              pInputTextarea
              name="descricao"
              maxlength="4000"
              [rows]="5" 
              [cols]="180" 
              [(ngModel)]="manual.observacao">
          </textarea>
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12" style="margin-bottom: 25px">
            <label>Arquivo Manual *</label>
            <span class="md-inputfield">
              <p-fileUpload 
                #fileInput 
                chooseLabel="Selecionar arquivo" 
                [showUploadButton]="false" 
                [showCancelButton]="false" 
                name="arquivoManual" 
                (onSelect)="uploadFile($event)"
                accept=".pdf,.odt,.doc,.docx">
              </p-fileUpload>
            </span>
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12">

            <div class="ui-g-12 ui-md-12 ui-sm-12" style="margin-bottom: 25px">
              <label>Impacto</label>
            </div>

            <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
                <span class="md-inputfield">
                  <input 
                    required
                    type="text" 
                    maxlength="3"
                    name="parametroInclusao"
                    [(ngModel)]="manual.parametroInclusaoFormatado"
                    #parametroInclusao='ngModel'
                    pInputText/>
                  <label>Inclusão (%) *</label>
                  <div *ngIf="editForm.controls['parametroInclusao'] 
                  && !editForm.controls['parametroInclusao'].valid 
                  && (editForm.controls['parametroInclusao'].touched 
                  || editForm.submitted)" 
                  class="ui-message ui-messages-error">
                  Campo obrigatório.
                </div>
                </span>
            </div>
            <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
                <span class="md-inputfield">
                  <input 
                    required
                    type="text" 
                    maxlength="3"
                    name="parametroAlteracao"
                    [(ngModel)]="manual.parametroAlteracaoFormatado"
                    #parametroAlteracao='ngModel'
                    pInputText/>
                  <label>Alteração (%) *</label>
                  <div *ngIf="editForm.controls['parametroAlteracao'] 
                  && !editForm.controls['parametroAlteracao'].valid 
                  && (editForm.controls['parametroAlteracao'].touched 
                  || editForm.submitted)" 
                  class="ui-message ui-messages-error">
                  Campo obrigatório.
                </div>
                </span>
            </div>
            <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
                <span class="md-inputfield">
                    <input 
                      required
                      type="text" 
                      maxlength="3"
                      name="parametroExclusao"
                      [(ngModel)]="manual.parametroExclusaoFormatado"
                      #parametroExclusao='ngModel'
                      pInputText/>
                    <label>Exclusão (%) *</label>
                    <div *ngIf="editForm.controls['parametroExclusao'] 
                    && !editForm.controls['parametroExclusao'].valid 
                    && (editForm.controls['parametroExclusao'].touched 
                    || editForm.submitted)" 
                    class="ui-message ui-messages-error">
                    Campo obrigatório.
                  </div>
                  </span>
            </div>
            <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 25px">
                <span class="md-inputfield">
                    <input 
                      required
                      type="text" 
                      maxlength="3"
                      name="parametroConversao"
                      [(ngModel)]="manual.parametroConversaoFormatado"
                      #parametroConversao='ngModel'
                      pInputText/>
                    <label>Conversão (%) *</label>
                    <div *ngIf="editForm.controls['parametroConversao'] 
                    && !editForm.controls['parametroConversao'].valid 
                    && (editForm.controls['parametroConversao'].touched 
                    || editForm.submitted)" 
                    class="ui-message ui-messages-error">
                    Campo obrigatório.
                  </div>
                  </span>
            </div>

            <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-top: 25px; margin-bottom: 25px">

                <div class="ui-g-3 ui-md-4 ui-sm-12">
                    <label>Versão do CPM</label>
                </div>
      
                <div class="ui-g-2 ui-md-4 ui-sm-12">
                    <p-radioButton 
                      name="versaoCPM" 
                      label="4.2.1"
                      [value]="421"
                      [(ngModel)]="manual.versaoCPM">
                    </p-radioButton>
                </div>
      
                <div class="ui-g-4 ui-md-4 ui-sm-12">
                    <p-radioButton 
                      name="versaoCPM" 
                      label="4.3.1"
                      [value]="431"
                      [(ngModel)]="manual.versaoCPM">
                    </p-radioButton>
                </div>
      
              </div>

          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-g-3 ui-md-3 ui-sm-12">
              <app-blue-button 
                buttonLabel="Novo Esforco Fase" 
                buttonIcon="ui-icon-add" 
                (click)="openDialogPhaseEffort()">
              </app-blue-button>
            </div>
          </div>
        </div>
        
        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12">
            <app-memory-datatable [value]="manual.esforcoFases" (buttonClick)="datatableClick($event)">
              <p-column header="Tipo de Fase" field="fase.nome">
              </p-column>
              <p-column header="Percentual (%)" field="esforcoFormatado">
              </p-column>
            </app-memory-datatable>
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g-4 ui-g-offset-6">
            Total: {{ getPhaseEffortTotalPercentual() }} %
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-g-3 ui-md-3 ui-sm-12">
              <app-blue-button 
                buttonLabel="Novo Deflator" 
                buttonIcon="ui-icon-add" 
                (click)="openDialogCreateAdjustFactor()">
              </app-blue-button>
            </div>
          </div>
        </div>

        <div class="ui-g">
          <div class="ui-g-12 ui-md-12 ui-sm-12">
            <app-memory-datatable [value]="manual.fatoresAjuste" (buttonClick)="adjustFactorDatatableClick($event)">
              <p-column header="Código" field="codigo">
              </p-column>
              <p-column header="Nome" field="nome">
              </p-column>
              <p-column header="Deflator" field="fatorFormatado">
              </p-column>
              <p-column header="Tipo Deflator" field="tipoAjuste">
              </p-column>
              <p-column header="Ativo" field="ativo">
                <ng-template let-col let-ativo="rowData" pTemplate="body">
                  {{ ativo[col.field] | activeBoolean }}
                </ng-template>
              </p-column>
            </app-memory-datatable>
          </div>
        </div>

        <div class="ui-g" style="justify-content: center; margin-top: 25px;">
          <div class="ui-g-2 ui-md-2 ui-sm-12">
            <app-white-button buttonLabel="Cancelar" routerLink="/manual"></app-white-button>
          </div>
          <div class="ui-g-2 ui-md-2 ui-sm-12">
            <app-submit-button buttonLabel="Salvar" [disabled]="editForm.form.invalid || isSaving"></app-submit-button>
          </div>
        </div>

        <!-- Dialog Registro Esforco Fase -->
        <p-dialog header="Esforço por Fase" [(visible)]="showDialogPhaseEffort" [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Tipo de Fase *</label>
              <p-dropdown 
                id="nome_fase" 
                autofocus="true" 
                [options]="tipoFases" 
                [(ngModel)]="newPhaseEffort.fase" 
                placeholder="Tipo de Fase" 
                [autoWidth]="false" 
                name="fase" 
                optionLabel="nome">
              </p-dropdown>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Esforço (%) *</label>
              <p-spinner 
                id="esforco" 
                size="30" 
                name="esforco" 
                [(ngModel)]="newPhaseEffort.esforcoFormatado" 
                decimalSeparator="" 
                min="0" 
                max="100" 
                thousandSeparator="">
              </p-spinner>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g ui-md-12" style="justify-content: flex-end">
              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-white-button 
                  buttonLabel="Cancelar" 
                  (click)="closeDialogPhaseEffort()">
                </app-white-button>
              </div>

              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-green-button 
                  buttonLabel="Salvar" 
                  buttonIcon="ui-icon-add" 
                  (click)="addPhaseEffort()">
                </app-green-button>
              </div>
            </div>
          </div>
        </p-dialog>

        <!-- Dialog Edit  Esforco Fase -->
        <p-dialog 
          header="Esforço por Fase" 
          [(visible)]="showDialogEditPhaseEffort" 
          [contentStyle]="{'overflow':'visible'}" 
          [width]="800">

          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Tipo de Fase*</label>
              <p-dropdown 
                id="nome_fase_edit" 
                [options]="tipoFases" 
                [(ngModel)]="editedPhaseEffort.fase" 
                optionLabel="nome" 
                placeholder="Tipo de Fase" 
                name="fase" 
                dataKey="id" 
                [autoWidth]="false">
              </p-dropdown>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Esforço (%)*</label>
              <p-spinner 
                id="esforco_edit" 
                name="esforco" 
                [(ngModel)]="editedPhaseEffort.esforcoFormatado" 
                min="0" 
                max="100" 
                decimalSeparator="" 
                thousandSeparator="">
              </p-spinner>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g ui-md-12" style="justify-content: flex-end">
              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-white-button 
                  buttonLabel="Cancelar" 
                  (click)="closeDialogEditPhaseEffort()">
                </app-white-button>
              </div>

              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-green-button 
                  buttonLabel="Salvar" 
                  buttonIcon="ui-icon-add" 
                  (click)="editPhaseEffort()">
                </app-green-button>->
              </div>
            </div>
          </div>

        </p-dialog>
        <!-- Fim Dialog Edit  Esforco Fase -->

        <!-- Inicio Dialog Novo Deflator -->
        <p-dialog 
          header="Deflator" 
          [(visible)]="showDialogCreateAdjustFactor" 
          [contentStyle]="{'overflow':'visible'}" 
          [width]="800">
          <div class="ui-g">

            <div class="ui-g-6">
              <label>Nome *</label>
              <input 
                id="nome_fator_ajuste" 
                type="text" 
                name="nomeFatorAjuste" 
                [(ngModel)]="newAdjustFactor.nome" 
                pInputText />
            </div>

            <div class="ui-g-3">
              <label>Tipo Deflator *</label><br>
              <p-dropdown 
                #dd 
                id="tipo_ajuste" 
                [options]="adjustTypes" 
                name="tipoAjuste" 
                [(ngModel)]="newAdjustFactor.tipoAjuste" 
                filter="true" 
                [autoWidth]="false" 
                placeholder="Tipo Ajuste">
              </p-dropdown>
            </div>

            <div class="ui-g-3">
              <label *ngIf="isPercentualEnum(newAdjustFactor.tipoAjuste)">Deflator (%) *</label>
              <label *ngIf="isUnitaryEnum(newAdjustFactor.tipoAjuste)">Deflator (PF) *</label>
              <label *ngIf="newAdjustFactor.tipoAjuste === undefined">Deflator *</label>
              
              <input 
                id="valor_fator"
                size="3" 
                name="fator"
                [disabled]="habilitarDeflator()" 
                [(ngModel)]="newAdjustFactor.fatorFormatado"
                pInputText/>

            </div>

          </div>
          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Descrição</label>
            </div>
          </div>
          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <textarea 
                [rows]="5" 
                [cols]="90" 
                pInputTextarea name="descricaoFatorAjuste" 
                [(ngModel)]="newAdjustFactor.descricao">
              </textarea>
            </div>
          </div>
          <div class="ui-g">
            <div class="ui-g-5 ui-md-5 ui-sm-12">
              <label>Codigo</label>
              <input 
                id="codigo_fator" 
                type="text" 
                name="codigo" 
                [(ngModel)]="newAdjustFactor.codigo" 
                pInputText />
            </div>
            <div class="ui-g-7 ui-md-7 ui-sm-12">
              <label>Origem</label>
              <input id="origem_fator" 
                type="text" 
                name="origem" 
                [(ngModel)]="newAdjustFactor.origem" 
                pInputText />
            </div>
          </div>
          <div class="ui-g">
            <div class="ui-g ui-md-12" style="justify-content: flex-end">
              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-white-button 
                  buttonLabel="Cancelar" 
                  (click)="closeDialogCreateAdjustFactor()">
                </app-white-button>
              </div>

              <div class="ui-g-2 ui-md-2 ui-sm-12">
                <app-green-button 
                  buttonLabel="Salvar" 
                  buttonIcon="ui-icon-add" 
                  (click)="addAdjustFactor()">
                </app-green-button>
              </div>
            </div>
          </div>

        </p-dialog>
        <!-- Fim Dialog Novo Deflator -->

        <!-- Inicio Dialog Edit Fator Ajuste -->
        <p-dialog 
          header="Fator de Ajuste" 
          [(visible)]="showDialogEditAdjustFactor" 
          [contentStyle]="{'overflow':'visible'}" 
          [width]="800">

          <div class="ui-g">
            <div class="ui-g-6 ui-md-6 ui-sm-12">
              <label>Nome *</label>
              <input 
                id="nome_fator_ajuste" 
                type="text" 
                name="nomeEdicaoFatorAjuste" 
                [(ngModel)]="editedAdjustFactor.nome" 
                pInputText />
            </div>

            <div class="ui-g-3 ui-md-3 ui-sm-12">
              <label>Tipo Ajuste *</label><br>
              <p-dropdown 
                id="tipo_ajuste" 
                [options]="adjustTypes" 
                name="tipoAjuste" 
                [(ngModel)]="editedAdjustFactor.tipoAjuste" 
                filter="true" 
                [autoWidth]="false">
              </p-dropdown>
            </div>

            <div class="ui-g-3 ui-md-3 ui-sm-12">
              <label *ngIf="isPercentualEnum(editedAdjustFactor.tipoAjuste)">Deflator (%) *</label>
              <label *ngIf="isUnitaryEnum(editedAdjustFactor.tipoAjuste)">Deflator (PF) *</label>
              <label *ngIf="editedAdjustFactor.tipoAjuste === undefined">Deflator *</label>
              
              <input 
                id="valor_fator"
                size="3" 
                name="fator"
                [disabled]="habilitarDeflator()" 
                [(ngModel)]="editedAdjustFactor.fatorFormatado"
                pInputText/>

            </div>

          </div>
          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <label>Descrição</label>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g-12 ui-md-12 ui-sm-12">
              <textarea 
                [rows]="5" 
                [cols]="90" 
                pInputTextarea 
                name="descricaoEdicaoFatorAjuste" 
                [(ngModel)]="editedAdjustFactor.descricao">
              </textarea>
            </div>
          </div>

          <div class="ui-g">
            <div class="ui-g-5 ui-md-5 ui-sm-12">
              <label>Codigo*</label>
              <input 
                id="codigo_fator" 
                type="text" 
                name="codigo" 
                [(ngModel)]="editedAdjustFactor.codigo" 
                pInputText />
            </div>

            <div class="ui-g-7 ui-md-7 ui-sm-12">
              <label>Origem*</label>
              <input 
                id="origem_fator" 
                type="text" 
                name="origem" 
                [(ngModel)]="editedAdjustFactor.origem" 
                pInputText />
            </div>

          </div>
          <div class="ui-g">
            <div class="ui-g ui-md-12" style="justify-content: flex-end">
              <div class="ui-g-3 ui-md-3 ui-sm-12">
                <app-white-button 
                  buttonLabel="Cancelar" 
                  (click)="closeDialogEditAdjustFactor()">
                </app-white-button>
              </div>

              <div class="ui-g-3 ui-md-3 ui-sm-12">
                <app-green-button 
                  buttonLabel="Salvar" 
                  buttonIcon="ui-icon-add" 
                  (click)="editAdjustFactor()">
                </app-green-button>
              </div>
            </div>
          </div>
        </p-dialog>
        <!-- Inicio Dialog Edit Fator Ajuste -->

        <p-confirmDialog header="Confirmação" #dialog>
          <p-footer>
            <app-white-button buttonLabel="Não" buttonIcon="fa-close" (click)="dialog.reject()"></app-white-button>
            <app-green-button buttonLabel="Sim" buttonIcon="fa-close" (click)="dialog.accept()"></app-green-button>
          </p-footer>
        </p-confirmDialog>
      </form>
    </div>
  </div>
</div>
