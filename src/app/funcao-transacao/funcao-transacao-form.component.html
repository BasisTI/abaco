<div class="ui-g ui-fluid">
    <div class="ui-g-12">
        <div class="card card-w-title">

            <div class="ui-g">
                <div class="ui-g-12">
                    <div class="ui-g ui-md-12" style="justify-content: flex-end; margin-bottom: 25px; margin-top: 25px">
                        <div class="ui-md-2" *ngIf="!isView">
                            <app-green-button
                                    buttonLabel="Novo"
                                    buttonIcon="ui-icon-add"
                                    (click)="openDialog(false)">
                            </app-green-button>
                        </div>
                    </div>

                    <!-- Inicio da tabela -->
                    <div>
                        <app-memory-datatable
                                [disableDelete]="this.isView"
                                [disableEdit]="this.isView"
                                [disableClone]="this.isView"
                                [value]="funcoesTransacoes"
                                (buttonClick)="datatableClick($event)"
                                [responsive]="true"
                                scrollable="true"
                                scrollWidth="100%">

                            <p-column
                                    field="name"
                                    header="Nome"
                                    [style]="{'width': '200px'}">
                            </p-column>

                            <p-column
                                    header="Deflator"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-fatorAjuste="rowData.fatorAjuste"
                                        pTemplate="body">
                                    {{ fatorAjuste ? fatorAjuste.nome : 'Nenhum' }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    header="Impacto"
                                    [style]="{'width': '200px'}"
                                    field="impacto">
                            </p-column>

                            <p-column
                                    header="Módulo"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-modulo="rowData.funcionalidade.modulo"
                                        pTemplate="body">
                                    {{ modulo.nome }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    header="Funcionalidade"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-funcionalidade="rowData.funcionalidade"
                                        pTemplate="body">
                                    {{ funcionalidade.nome }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    field="tipo"
                                    header="Classificação"
                                    [style]="{'width': '200px'}">
                            </p-column>

                            <p-column
                                    field="der"
                                    header="DER (TD)"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-funcaoDados="rowData"
                                        pTemplate="body">
                                    {{ funcaoDados.derValue() }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    header="FTR (AR)"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-funcaoDados="rowData"
                                        pTemplate="body">
                                    {{ funcaoDados.ftrValue() }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    field="complexidade"
                                    header="Complexidade"
                                    [style]="{'width': '200px'}">
                            </p-column>

                            <p-column
                                    header="PF Bruto"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-grossPF="rowData.grossPF"
                                        pTemplate="body">
                                    {{ grossPF | number }}
                                </ng-template>
                            </p-column>

                            <p-column
                                    header="PF Líquido"
                                    [style]="{'width': '200px'}">
                                <ng-template
                                        let-pf="rowData.pf"
                                        pTemplate="body">
                                    {{ pf | number }}
                                </ng-template>
                            </p-column>

                        </app-memory-datatable>
                    </div>
                    <!-- fim table -->
                </div>
            </div>


            <!-- DIALOG: ADICIONAR E EDITAR FUNÇÃO DE DADOS -->
            <p-dialog
                    [closable]="false"
                    [(visible)]="showDialog"
                    [(header)]="textHeader"
                    [contentStyle]="{'height': ['windowHeightDialog']}"
                    [width]="[windowWidthDialog]">

                <div class="ui-g" *ngIf="!showMultiplos">
                    <div class="ui-g-9">
                        <label>Nome do Processo Elementar *</label>
                        <p-autoComplete
                                [(ngModel)]="currentFuncaoTransacao.name"
                                [suggestions]="baselineResultados"
                                (completeMethod)="searchBaseline($event)"
                                field="name"
                                (onSelect)="recuperarNomeSelecionado($event)">
                        </p-autoComplete>
                        <div *ngIf="nomeInvalido"
                             class="ui-message ui-messages-error">
                            Campo obrigatório.
                        </div>
                    </div>
                    <div class="ui-g-3">
                        <app-blue-button
                                buttonLabel="Múltiplos"
                                (click)="buttonMultiplos()">
                        </app-blue-button>
                    </div>
                </div>

                <div class="ui-g" *ngIf="showMultiplos">
                    <div class="ui-g-9">
                        <label>Nome *</label>
                        <textarea pInputTextarea
                                  [(ngModel)]="text"
                                  style="white-space: nowrap; overflow: auto;"
                                  [autoResize]="false"
                                  (keyup.enter)="textChanged()"
                                  (keyup.backspace)="textChanged()"
                                  (keyup.delete)="textChanged()"
                                  (change)="textChanged()"
                                  [rows]="6" [cols]="180"
                                  name="{{ label }}">
                         </textarea>
                    </div>
                    <div class="ui-g-3">
                        <app-blue-button
                                buttonLabel="Unitário"
                                (click)="buttonMultiplos()">
                        </app-blue-button>
                    </div>
                </div>


                <app-analise-modulo-funcionalidade
                        [isFuncaoDados]="false"
                        (moduloSelectedEvent)="moduloSelected($event)"
                        (funcionalidadeSelectedEvent)="functionalitySelected($event)">
                </app-analise-modulo-funcionalidade>

                <div class="ui-g">
                    <div class="ui-g-3 ui-md-6 ui-sm-12">
                        <label>Classificação *</label>
                        <p-dropdown
                                [filter]="true"
                                [options]="classificacoes"
                                [(ngModel)]="currentFuncaoTransacao.tipo"
                                placeholder="Selecione uma Classificação"
                                name="classificacao"
                                [autoWidth]="false"
                                (onChange)="classValida()">
                        </p-dropdown>
                        <div *ngIf="classInvalida"
                             class="ui-message ui-messages-error">
                            Campo obrigatório.
                        </div>
                    </div>

                    <div class="ui-g-3 ui-md-6 ui-sm-12">
                        <label>Impacto *</label>
                        <p-dropdown
                                [filter]="true"
                                [options]="impacto"
                                [(ngModel)]="currentFuncaoTransacao.impacto"
                                placeholder="Selecione..."
                                name="impacto"
                                [autoWidth]="false"
                                (onChange)="impactoValido()">
                        </p-dropdown>
                        <div *ngIf="impactoInvalido"
                             class="ui-message ui-messages-error">
                            Campo obrigatório.
                        </div>
                    </div>

                </div>
                <div class="ui-g">
                    <div class="ui-g-3 ui-md-6 ui-sm-12">
                        <label>Deflator</label>
                        <p-dropdown
                                [filter]="true"
                                [options]="fatoresAjuste"
                                [(ngModel)]="currentFuncaoTransacao.fatorAjuste"
                                [disabled]="!isContratoSelected()"
                                [placeholder]="fatoresAjusteDropdownPlaceholder()"
                                (onChange)="contratoSelecionado()"
                                name="fatorAjuste"
                                [autoWidth]="false">
                        </p-dropdown>
                        <div *ngIf="erroDeflator"
                             class="ui-message ui-messages-error">
                            Campo obrigatório.
                        </div>
                    </div>


                    <div class="ui-g-3 ui-md-6 ui-sm-12" [hidden]="hideShowQuantidade">
                        <label>Quantidade</label>
                        <input type="number" class="ui-inputtext" min="1"
                               [(ngModel)]="currentFuncaoTransacao.quantidade">
                        <div *ngIf="erroUnitario"
                             class="ui-message ui-messages-error">
                            Campo obrigatório.
                        </div>
                    </div>

                </div>


                <div class="ui-g-12 ui-md-12 ui-sm-12" [hidden]="hideElementTDTR">
                    <h2>FTR (AR)</h2>
                    <app-analise-der-chips
                            [(values)]="alrsChips"
                            [relacionarDers]="true"
                            (dersReferenciadosEvent)="dersReferenciados($event)">
                    </app-analise-der-chips>
                    <div *ngIf="erroTR"
                         class="ui-message ui-messages-error">
                        Campo obrigatório.
                    </div>

                </div>

                <div class="ui-g-12 ui-md-12 ui-sm-12" [hidden]="hideElementTDTR">
                    <h2>DER (TD)</h2>
                    <app-analise-der-chips [(values)]="dersChips"></app-analise-der-chips>
                    <div *ngIf="erroTD"
                         class="ui-message ui-messages-error">
                        Campo obrigatório.
                    </div>
                </div>

                <div class="ui-g-12 ui-md-12 ui-sm-12">
                    <label>Fundamentação</label>
                    <span class="md-inputfield">
                <textarea
                        [rows]="3"
                        [cols]="180"
                        pInputTextarea name="funcaoDadosSustentacao"
                        [(ngModel)]="currentFuncaoTransacao.sustantation">
                </textarea>
            </span>
                </div>

                <div class="ui-g ui-md-12 ui-sm-12" style="justify-content: flex-end">
                    <div class="ui-md-3 ui-sm-12" *ngIf="isEdit">
                        <app-white-button
                                buttonLabel="Cancelar"
                                (click)="cancelar()">
                        </app-white-button>
                    </div>

                    <div class="ui-g-3 ui-md-3 ui-sm-12" *ngIf="!isEdit">
                        <app-white-button
                                buttonLabel="Fechar"
                                (click)="cancelar()">
                        </app-white-button>
                    </div>

                    <div class="ui-md-3 ui-sm-12">
                        <app-blue-button
                                buttonLabel="Salvar"
                                buttonIcon="ui-icon-add"
                                (click)="buttonSaveEdit()">
                        </app-blue-button>
                    </div>
                </div>
            </p-dialog>
            <!-- Fim Dialog adicionar função de dados  -->

        </div>
    </div>
</div>