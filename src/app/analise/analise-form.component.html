<p-tabView (onChange)="handleChange($event)">
    <p-tabPanel [header]="this.getLabel('Analise.Analise.Geral')" [selected]= "true">
        <div class="ui-g ui-fluid">
            <div class="ui-g-12">
                <div class="card card-w-title">
                    <form name="editForm" role="form" novalidate (ngSubmit)="save()" #editForm="ngForm">
                        <div>
                            <div class="ui-g">
                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.Organizacao">Organização</label>
                                    <p-dropdown
                                            [filter]="true"
                                            dataKey="id"
                                            id="idOrganizacaoSaveFormAnalise"
                                            name="organizacao"
                                            optionLabel="nome"
                                            [disabled]="disabledOptionsforEdit()"
                                            [placeholder]="this.getLabel('Analise.Analise.Selecione')"
                                            [options]="organizacoes"
                                            [(ngModel)]="analise.organizacao"
                                            [autoWidth]="false"
                                            (onChange)="setSistemaOrganizacao($event.value)">
                                    </p-dropdown>
                                </div>
                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.Sistema">Sistema</label>
                                    <p-dropdown
                                            [filter]="true"
                                            dataKey="id"
                                            id="idSistemaSaveFormAnalise"
                                            optionLabel="sigla"
                                            [disabled]="disabledOptionsforEdit()"
                                            [placeholder]="this.getLabel('Analise.Analise.Selecione')"
                                            (onChange)="getSistemaSelecionado()"
                                            name="sistema"
                                            [options]="sistemas"
                                            [(ngModel)]="analise.sistema"
                                            [autoWidth]="false">
                                    </p-dropdown>
                                </div>
                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.EquipeResponsavel">Equipe Responsável</label>
                                    <p-dropdown
                                            [filter]="true"
                                            dataKey="id"
                                            id="idEquipeResponsavelSaveFormAnalise"
                                            name="equipeResponsavel"
                                            optionLabel="nome"
                                            [disabled]="disabledOptionsforEdit()"
                                            [placeholder]="this.getLabel('Analise.Analise.Selecione')"
                                            [disabled]="hideShowSelectEquipe"
                                            [options]="equipeResponsavel"
                                            [(ngModel)]="analise.equipeResponsavel"
                                            [autoWidth]="false">
                                    </p-dropdown>
                                </div>
                            </div>
                        </div>
                        <div style="margin-bottom: 05px; margin-top: 05px" *ngIf="analise.equipeResponsavel">
                            <div class="ui-g">
                                <div class="ui-g-4 ui-md-3 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.IdentificadorAnalise*">Identificador da Analise
                                        *</label>
                                    <span class="md-inputfield">
                                        <input
                                                required
                                                type="text"
                                                maxlength="100"
                                                id="idIdentificadorAnaliseFormAnalise"
                                                name="identificadorAnalise"
                                                [(ngModel)]="analise.identificadorAnalise"
                                                pInputText/>
                                    </span>
                                </div>
                                <div class="ui-g-3 ui-md-3 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.DataCriacaoOrdemServico">Data Criação da O. S.
                                        *</label>
                                    <span class="md-inputfield">
                                        <p-calendar
                                                required
                                                name="dataCriacaoOrdemServico"
                                                [(ngModel)]="analise.dataCriacaoOrdemServico"
                                                id="idDataCriacaoOrdemServicoFormAnalise"
                                                dateFormat="dd/mm/yy"
                                                showIcon="true"
                                        ></p-calendar>
                                     </span>
                                </div>
                                <div class="ui-g-3 ui-md-2 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.Contrato*">Contrato *</label>
                                    <p-dropdown
                                            [filter]="true"
                                            required
                                            id="idContratoFormAnalise"
                                            dataKey="id"
                                            optionLabel="numeroContrato"
                                            [placeholder]="this.getLabel('Analise.Analise.Selecione')"
                                            (onChange)="contratoSelected($event.value)"
                                            [disabled]="disabledOptionsforEdit()"
                                            name="contrato"
                                            [options]="contratos"
                                            [(ngModel)]="analise.contrato"
                                            [autoWidth]="false">
                                    </p-dropdown>
                                </div>
                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.Manual*">Manual *</label>
                                    <p-dropdown
                                            required
                                            [filter]="true"
                                            id="idManual"
                                            name="manual"
                                            [disabled]="disabledOptionsforEdit()"
                                            [options]="manuaisCombo"
                                            (onChange)="setManual($event.value)"
                                            [(ngModel)]="analise.manual"
                                            [autoWidth]="false"
                                            datakey="id">
                                        <div class="row">
                                            <ng-template let-manualSelc pTemplate="selectedItem">
                                                {{manualSelc.label}}
                                            </ng-template>

                                        </div>
                                    </p-dropdown>
                                </div>
                                <div [ngClass]="(disabledOptionsforEdit())? '(ui-g-4 ui-md-4 ui-sm-12)' : '(ui-g-6 ui-md-6 ui-sm-12)'"
                                     style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.MetodoContagem*">Método de Contagem *</label>
                                    <p-dropdown
                                            [filter]="true"
                                            required
                                            id="idMetodoContagemFormAnalise"
                                            [placeholder]="this.getLabel('Analise.Analise.SelecioneUmContrato')"
                                            name="metodoContagem"
                                            [options]="metodosContagem"
                                            [(ngModel)]="analise.metodoContagem"
                                            [autoWidth]="false"
                                            (onChange)="alterarMetodoContagem()">
                                    </p-dropdown>
                                </div>
                                <div [ngClass]="(disabledOptionsforEdit())? '(ui-g-4 ui-md-4 ui-sm-12)' : '(ui-g-6 ui-md-6 ui-sm-12)'"
                                     style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.TipoContagem*">Tipo de Contagem *</label>
                                    <p-dropdown
                                            [filter]="true"
                                            required
                                            id="idTipoContagemFormAnalise"
                                            name="tiposAnalise"
                                            [placeholder]="this.getLabel('Analise.Analise.Selecione')"
                                            [options]="tiposAnalise"
                                            [(ngModel)]="analise.tipoAnalise"
                                            [disabled]="disabledOptionsforEdit()"
                                            [autoWidth]="false">
                                    </p-dropdown>
                                </div>

                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px"
                                     *ngIf="analise.id">
                                    <label translate="Analise.Analise.Usuarios">Usuários</label>
                                    <p-multiSelect
                                            [filter]="true"
                                            required
                                            dataKey="id"
                                            name="usersMultiselect"
                                            [(options)]="users"
                                            [(ngModel)]="analise.users"
                                            optionLabel="nome"
                                            [autoWidth]="false"
                                            selectedItemsLabel="{0} Usuários Selecionados"
                                            #usersMultiselect='ngModel'>
                                    </p-multiSelect>
                                </div>
                                <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-bottom: 05px"
                                >
                                    <label translate="Analise.Analise.PropositoContagem">Propósito da Contagem</label>
                                    <span class="md-inputfield">
                                        <textarea
                                                maxlength="4000"
                                                pInputTextarea name="propositoContagem"
                                                id="idPropositoContagemFormAnalise"
                                                [(ngModel)]="analise.propositoContagem">
                                        </textarea>
                                    </span>
                                </div>

                                <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-bottom: 05px"
                                >
                                    <label translate="Analise.Analise.EscopoContagem">Escopo da Contagem</label>
                                    <span class="md-inputfield">
                                        <textarea
                                                maxlength="4000"
                                                pInputTextarea name="escopo"
                                                id="idEscopoContagemFormAnalise"
                                                [(ngModel)]="analise.escopo">
                                        </textarea>
                                    </span>
                                </div>

                                <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-bottom: 05px"
                                >
                                    <label translate="Analise.Analise.Fronteira">Fronteira</label>
                                    <span class="md-inputfield">
                                        <textarea
                                                maxlength="4000"
                                                pInputTextarea name="fronteiras"
                                                id="idFronteirasFormAnalise"
                                                [(ngModel)]="analise.fronteiras">
                                        </textarea>
                                    </span>
                                </div>

                                <div class="ui-g-6 ui-md-6 ui-sm-12" style="margin-bottom: 05px"
                                >
                                    <label translate="Analise.Analise.Documentacao">Documentação</label>
                                    <span class="md-inputfield">
                                        <textarea
                                                maxlength="4000"
                                                required
                                                pInputTextarea name="documentacao"
                                                id="idDocumentacaoFormAnalise"
                                                [(ngModel)]="analise.documentacao">
                                        </textarea>
                                    </span>
                                </div>

                                <div class="ui-g-4 ui-md-4 ui-sm-12">

                                    <div class="ui-g-6 ui-md-6 ui-sm-12">
                                        {{this.getLabel('Analise.Analise.AguardarPrazoGarantia')}} {{diasGarantia > 0 ? this.getLabel('Analise.Analise.De') + diasGarantia + this.getLabel('Analise.Analise.Dias')
                                        : null}}?
                                    </div>

                                    <div class="ui-g-3 ui-md-2 ui-sm-12">
                                        <p-radioButton
                                                name="baseline_imediatamente"
                                                [label]="this.getLabel('Global.Botoes.Sim')"
                                                id="idAguardarPrazoGarantiaSimFormAnalise"
                                                [value]="true"
                                                [(ngModel)]="analise.baselineImediatamente">
                                        </p-radioButton>
                                    </div>

                                    <div class="ui-g-3 ui-md-2 ui-sm-12">
                                        <p-radioButton
                                                name="baseline_imediatamente"
                                                [label]="this.getLabel('Global.Botoes.Nao')"
                                                id="idAguardarPrazoGarantiaNaoFormAnalise"
                                                [value]="false"
                                                [(ngModel)]="analise.baselineImediatamente">
                                        </p-radioButton>
                                    </div>

                                </div>

                                <div class="ui-g-4 ui-md-4 ui-sm-12">

                                    <div class="ui-g-6 ui-md-6 ui-sm-12" translate="Analise.Analise.IncorporarBaseline">
                                        Incorporar a Baseline
                                    </div>
                                    <div class="ui-g-3 ui-md-2 ui-sm-12">
                                        <p-radioButton
                                                name="baseline_enviar_baseline"
                                                [label]="this.getLabel('Global.Botoes.Sim')"
                                                id="idEnviarBaselineSimFormAnalise"
                                                [value]="true"
                                                [(ngModel)]="analise.enviarBaseline">
                                        </p-radioButton>
                                    </div>
                                    <div class="ui-g-3 ui-md-2 ui-sm-12">
                                        <p-radioButton
                                                name="baseline_enviar_baseline"
                                                [label]="this.getLabel('Global.Botoes.Nao')"
                                                id="idEnviarBaselineNaoFormAnalise"
                                                [value]="false"
                                                [(ngModel)]="analise.enviarBaseline">
                                        </p-radioButton>
                                    </div>
                                </div>
                                <div class="ui-g-4 ui-md-4 ui-sm-12" style="margin-bottom: 05px; margin-top: 05px"
                                >
                                    <span class="md-inputfield">
                                        <p-calendar
                                                [required]="analise.baselineImediatamente"
                                                name="dataHomologacao"
                                                [(ngModel)]="analise.dataHomologacao"
                                                id="idDataHomolagacaoFormAnalise"
                                                dateFormat="dd/mm/yy"
                                                showIcon="true">
                                        </p-calendar>
                                        <label>{{this.getLabel('Analise.Analise.DataHomologacao')}} {{analise.baselineImediatamente ? " *" : null}}</label>
                                    </span>
                                </div>
                                <p-fieldset [legend]="this.getLabel('Analise.Analise.Fases')" [toggleable]="true"
                                            [collapsed]="true">
                                    <div class="ui-g-12 ui-md-12 ui-sm-12" style="margin-bottom: 05px">
                                        <p-dataTable
                                                dataKey="id"
                                                [emptyMessage]="this.getLabel('Analise.Analise.Mensagens.msgSelecioneContratoParaEscolherFases')"
                                                [value]="esforcoFases"
                                                id="idTabelaFases"
                                                [(selection)]="analise.esforcoFases">
                                            <p-header translate="Analise.Analise.Fases">Fases</p-header>

                                            <p-column selectionMode="multiple" [style]="{'width':'15%'}"></p-column>

                                            <p-column [header]="this.getLabel('Analise.Analise.Nome')"
                                                      field="fase.nome"></p-column>

                                            <p-column [header]="this.getLabel('Analise.Analise.Esforco')"
                                                      field="esforco"></p-column>

                                            <p-footer *ngIf="analise.contrato">
                                                {{this.getLabel('Analise.Analise.Total')}} {{ totalEsforcoFases() }}%
                                            </p-footer>
                                        </p-dataTable>
                                    </div>
                                </p-fieldset>
                                <div class="ui-g-12 ui-md-12 ui-sm-12" style="margin-bottom: 05px">
                                    <label translate="Analise.Analise.Observacoes">Observações</label>
                                    <span class="md-inputfield">
                                        <textarea
                                                [rows]="3"
                                                id="idObservacoesFormAnalise"
                                                [cols]="180"
                                                maxlength="4000"
                                                autoResize=true
                                                pInputTextarea name="observacoes"
                                                [(ngModel)]="analise.observacoes">
                                        </textarea>
                                    </span>
                                </div>

                                <div class="ui-g ui-md-12"
                                     style="justify-content: center; margin-bottom: 05px; margin-top: 05px">
                                    <div class="ui-g-12 ui-md-12 ui-lg-2" style="margin-bottom: 05px">
                                        <app-white-button
                                                [buttonLabel]="'Global.Botoes.Voltar' | translate"
                                                id="idBtnVoltarFormAnalise"
                                                routerLink="/analise">
                                        </app-white-button>
                                    </div>
                                    <div class="ui-g-12 ui-md-12 ui-lg-2" style="margin-bottom: 05px">
                                        <app-green-button
                                                type="submit"
                                                id="idBtnSalvarFormAnalise"
                                                [buttonLabel]="'Global.Botoes.Salvar' | translate"
                                                (click)="save()">
                                        </app-green-button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </p-tabPanel>

    <p-tabPanel [header]="this.getLabel('Analise.Analise.FuncoesDados')" [disabled]="disableAba" ></p-tabPanel>

    <p-tabPanel [header]="this.getLabel('Analise.Analise.FuncoesTransacao')"[disabled]="disableFuncaoTrasacao"></p-tabPanel>

    <p-tabPanel [header]="this.getLabel('Analise.Analise.Resumo')" [disabled]="disableAba" ></p-tabPanel>
</p-tabView>

<!-- Dialog confirmação deleção -->
<p-confirmDialog [header]="this.getLabel('Global.Mensagens.Confirmacao')" #dialog>
    <p-footer>
        <button type="button" pButton icon="fa-close" [label]="'Global.Botoes.Nao' | translate"
                (click)="dialog.reject()"></button>
        <button type="button" pButton icon="fa-check" [label]="'Global.Botoes.Sim' | translate"
                (click)="dialog.accept()"></button>
    </p-footer>
</p-confirmDialog>
