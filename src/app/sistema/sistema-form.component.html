<div class="ui-g ui-fluid">
  <div class="ui-g-12">
    <div class="card card-w-title">
      <h1>{{ sistema.id ? 'Editar Sistema' : 'Cadastrar Sistema' }}</h1>
      <form name="editForm" role="form" novalidate (ngSubmit)="save()" #editForm="ngForm"
        (keydown.enter)="$event.preventDefault()">
        <div class="ui-g">

          <div class="ui-g-6" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input 
                id="sigla_sistema" 
                type="text" 
                name="siglaSistema" 
                [(ngModel)]="sistema.sigla" 
                maxlength="20" 
                pInputText/>
              <label>Sigla*</label>
            </span>
          </div>

          <div class="ui-g-6" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input 
                id="nome_sistema" 
                type="text" 
                name="nomeSistema" 
                [(ngModel)]="sistema.nome" 
                maxlength="100" 
                pInputText/>
              <label>Nome do Sistema*</label>
            </span>
          </div>

          <div class="ui-g-6" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input 
                type="text" 
                name="numeroOcorrenciaSistema" 
                maxlength="100"
                [(ngModel)]="sistema.numeroOcorrencia" 
                pInputText/>
              <label>Número da Ocorrência</label>
            </span>
          </div>

          <div class="ui-g-6" style="margin-bottom: 25px">
            <p-dropdown 
              id="organizacao_sistema" 
              [options]="organizacaos" 
              optionLabel="nome" 
              placeholder="Organização*"
              name="organizacao" 
              [(ngModel)]="sistema.organizacao" 
              [autoWidth]="false" 
              dataKey="id" 
              required>
            </p-dropdown>
          </div>

        </div>

        <!-- Módulos -->
        <div class="ui-g">
          <h4 style="margin-bottom: 0px; margin-top: 0px;">
            Módulos
          </h4>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-md-2">
              <app-blue-button 
                buttonLabel="Novo Módulo" 
                buttonIcon="ui-icon-add" 
                (click)="abrirDialogModulo()">
              </app-blue-button>
            </div>
          </div>

          <!-- Datatable modulos -->
          <app-memory-datatable [value]="sistema.modulos"
            [editEventName]="editModuloEventName"
            [deleteEventName]="deleteModuloEventName"
            (buttonClick)="datatableClick($event)">
            <p-column header="Código"
              [style]="{width: '25%'}">
              <ng-template let-codigo="rowData.id" pTemplate="body">
                {{ codigo ? codigo : 'Ainda não cadastrado' }}
              </ng-template>
            </p-column>
            <p-column header="Nome" field="nome"></p-column>
          </app-memory-datatable>

        </div>

        <!-- Funcionalidades -->
        <div class="ui-g">
          <h4 style="margin-bottom: 0px;">
            Funcionalidades
          </h4>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-md-2">
              <app-blue-button 
                buttonLabel="Nova Funcionalidade"
                buttonIcon="ui-icon-add" 
                (click)="abrirDialogFuncionalidade()"
                [isDisabled]="deveDesabilitarBotaoNovaFuncionalidade()">
              </app-blue-button>
            </div>
          </div>

          <!-- Datatable Funcionalidades -->
          <app-memory-datatable [value]="sistema.funcionalidades"
            [editEventName]="editFuncionalidadeEventName"
            [deleteEventName]="deleteFuncionalidadeEventName"
            (buttonClick)="datatableClick($event)">
            <p-column header="Módulo" field="modulo.nome"></p-column>
            <p-column header="Nome" field="nome"></p-column>
          </app-memory-datatable>
        </div>

        <!-- Botões salvar e cancelar do fim da página -->
        <div class="ui-g" style="justify-content: center; margin-top: 25px;">
          <div class="ui-g-2">
            <app-white-button buttonLabel="Cancelar" routerLink="/sistema"></app-white-button>
          </div>
          <div class="ui-g-2">
            <app-submit-button buttonLabel="Salvar" [disabled]="editForm.form.invalid || isSaving"></app-submit-button>
          </div>
        </div>

        <!-- Dialog módulo -->
        <p-dialog header="Módulo" [(visible)]="mostrarDialogModulo"
          [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">
            <div class="ui-g-12" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input 
                  type="text" 
                  name="nomeModulo"
                  maxlength="100"
                  [(ngModel)]="novoModulo.nome"
                  pInputText 
                  (keydown.enter)="adicionarModulo()"/>
                <label>Nome do Módulo</label>
              </span>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-g-2">
              <app-white-button 
                buttonLabel="Cancelar" 
                (click)="fecharDialogModulo()">
              </app-white-button>
            </div>
            <div class="ui-g-2">
              <app-green-button 
                buttonLabel="Salvar" 
                (click)="adicionarModulo()">
              </app-green-button>
            </div>
          </div>
        </p-dialog>

        <!-- Dialog Editar módulo -->
        <p-dialog 
          header="Editar Módulo" 
          [(visible)]="mostrarDialogEditarModulo"
          [contentStyle]="{'overflow':'visible'}" 
          [width]="800">
          <div class="ui-g">
            <div class="ui-g-12" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input 
                  type="text" 
                  name="nomeModulo"
                  maxlength="100"
                  [(ngModel)]="moduloEmEdicao.nome"
                  pInputText 
                  (keydown.enter)="editarModulo()"/>
                <label>Nome do Módulo</label>
              </span>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">

            <div class="ui-g-2">
              <app-white-button 
                buttonLabel="Cancelar" 
                (click)="fecharDialogEditarModulo()">
              </app-white-button>
            </div>

            <div class="ui-g-2">
              <app-green-button 
                buttonLabel="Salvar" 
                (click)="editarModulo()">
              </app-green-button>
            </div>

          </div>
        </p-dialog>

        <!-- Dialog confirmação deleção -->
        <p-confirmDialog header="Confirmação" #dialog>
          <p-footer>
            <button type="button" pButton icon="fa-close" label="Não" (click)="dialog.reject()"></button>
            <button type="button" pButton icon="fa-check" label="Sim" (click)="dialog.accept()"></button>
          </p-footer>
        </p-confirmDialog>

        <!-- Dialog funcionalidade -->
        <p-dialog header="Funcionalidade" [(visible)]="mostrarDialogFuncionalidade"
          [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">
            <div class="ui-g-12" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input 
                  type="text" 
                  name="nomeFuncionalidade"
                  maxlength="100"
                  [(ngModel)]="novaFuncionalidade.nome" 
                  pInputText />
                <label>Nome da Funcionalidade</label>
              </span>
            </div>

            <div class="ui-g-12" style="margin-bottom: 25px">
              <p-dropdown [options]="sistema.modulos" optionLabel="nome"
                placeholder="Módulo" name="funcionalidadeModulo"
                [(ngModel)]="novaFuncionalidade.modulo" [autoWidth]="false">
              </p-dropdown>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">

            <div class="ui-g-2">
              <app-white-button 
                buttonLabel="Cancelar" 
                (click)="fecharDialogFuncionalidade()">
              </app-white-button>
            </div>

            <div class="ui-g-2">
              <app-green-button 
                buttonLabel="Salvar" 
                (click)="adicionarFuncionalidade()">
              </app-green-button>
            </div>
          </div>

        </p-dialog>

        <!-- Dialog editar funcionalidade -->
        <p-dialog header="Funcionalidade" [(visible)]="mostrarDialogEditarFuncionalidade"
          [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">

            <div class="ui-g-12" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input 
                  type="text" 
                  name="nomeFuncionalidade"
                  maxlength="100"
                  [(ngModel)]="funcionalidadeEmEdicao.nome" 
                  pInputText />
                <label>Nome da Funcionalidade</label>
              </span>
            </div>

            <div class="ui-g-12" style="margin-bottom: 25px">
              <p-dropdown 
                [options]="sistema.modulos" 
                optionLabel="nome"
                placeholder="Módulo" 
                name="funcionalidadeModulo"
                [(ngModel)]="funcionalidadeEmEdicao.modulo" 
                [autoWidth]="false">
              </p-dropdown>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">

            <div class="ui-g-2">
              <app-white-button 
                buttonLabel="Cancelar" 
                (click)="fecharDialogEditarFuncionalidade()">
              </app-white-button>
            </div>

            <div class="ui-g-2">
              <app-green-button 
                buttonLabel="Salvar" 
                (click)="editarFuncionalidade()">
              </app-green-button>
            </div>

          </div>
        </p-dialog>

      </form>
    </div>
  </div>
</div>
