<div class="ui-g ui-fluid">
  <div class="ui-g-12">
    <div class="card card-w-title">
      <h1>{{ organizacao.id ? 'Editar Organização' : 'Incluir Organização' }}</h1>
      <form name="editForm" role="form" novalidate (ngSubmit)="save()" #editForm="ngForm">
        <div class="ui-g">
          <div class="ui-g-2" style="margin-bottom: 25px">
            <span class="md-inputfield" >
              <input type="text" name="siglaOrganizacao" [(ngModel)]="organizacao.sigla" pInputText/>
              <label>Sigla</label>
            </span>
          </div>
          <div class="ui-g-10" style="margin-bottom: 25px">
            <span class="md-inputfield" >
              <input type="text" name="nomeOrganizacao" [(ngModel)]="organizacao.nome" pInputText/>
              <label>Nome da Organização</label>
            </span>
          </div>
          <div class="ui-g-5" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input type="text" name="cnpjOrganizacao" [(ngModel)]="organizacao.cnpj" pInputText/>
              <label>CNPJ</label>
            </span>
          </div>
          
          <div class="ui-g-7" style="margin-bottom: 25px">
            <span class="md-inputfield">
              <input type="text" name="numeroOcorrenciaOrganizacao" [(ngModel)]="organizacao.numeroOcorrencia" pInputText/>
              <label>Número da Ocorrência</label>
            </span>
          </div>

          <div class="ui-g-12" style="margin-bottom: 25px">
            <div class="ui-g">
              <div class="ui-g-12 ui-md-1">
                <label>Ativo</label>
              </div>
              <div class="ui-g-12 ui-md-1">
                <p-radioButton name="org_ativo" [value]="true" label="Sim"
                  [(ngModel)]="organizacao.ativo"></p-radioButton>
              </div>
              <div class="ui-g-12 ui-md-1">
                <p-radioButton name="org_ativo" [value]="false" label="Não"
                  [(ngModel)]="organizacao.ativo"></p-radioButton>
              </div>
            </div>
          </div>

          <div class="ui-g">
              <h4 style="margin-bottom: 0px; margin-top: 0px;">
                Contratos
              </h4>

            <div class="ui-g ui-md-12" style="justify-content: flex-end">
              <div class="ui-md-3">
                <button pButton type="button" label="Novo Contrato" icon="ui-icon-add"
                  (click)="abrirDialogCadastroContrato()"></button>
              </div>
            </div>
            
            <app-memory-datatable [value]="organizacao.contracts"
              (buttonClick)="datatableClick($event)">
              <p-column header="Número do Contrato" field="numeroContrato"></p-column>
              <p-column header="Ínicio Vigência" field="dataInicioVigencia">
                <ng-template let-col let-dataInicioVigencia="rowData" pTemplate="body">
                  {{ dataInicioVigencia[col.field] | date: 'dd/MM/y' }}
                </ng-template>
              </p-column>
              <p-column header="Final Vigência" field="dataFimVigencia">
                <ng-template let-col let-dataFimVigencia="rowData" pTemplate="body">
                  {{ dataFimVigencia[col.field] | date: 'dd/MM/y' }}
                </ng-template>
              </p-column>
              <p-column header="Manual" field="manual.nome"></p-column>
              <p-column header="Ativo" field="ativo">
                <ng-template let-col let-ativo="rowData" pTemplate="body">
                  {{ ativo[col.field] ? 'Sim' : 'Não' }}
                </ng-template>
              </p-column>
            </app-memory-datatable>
          </div>
        </div>

        <div class="ui-g" style="justify-content: center; margin-top: 25px;">
          <div class="ui-g-2">
            <button pButton type="button" label="Cancelar" routerLink="/organizacao"></button>
          </div>
          <div class="ui-g-2">
            <button pButton type="submit" label="Salvar" 
              (click)="save()"
              [disabled]="editForm.form.invalid || isSaving" ></button>
          </div>
        </div>

        <!-- Dialog Cadastro Contrato -->
        <p-dialog header="Contrato" [(visible)]="mostrarDialogCadastroContrato"
          [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input type="text" name="numeroContrato" [(ngModel)]="novoContrato.numeroContrato" pInputText/>
                <label>Número do Contrato</label>
              </span>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <p-dropdown [options]="manuais" optionLabel="nome" placeholder="Manual"
                name="manualDropdown" [(ngModel)]="novoContrato.manual"
                [autoWidth]="false" dataKey="id"></p-dropdown>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <p-calendar [(ngModel)]="novoContrato.dataInicioVigencia" name="dataInicioVigenciaContrato"
                  [monthNavigator]="true" [yearNavigator]="true" 
                  dateFormat="dd/mm/yy" yearRange="2000:2020"></p-calendar>
                <label>Data de Início da Vigência</label>
              </span>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
              <p-calendar [(ngModel)]="novoContrato.dataFimVigencia"
                [monthNavigator]="true" [yearNavigator]="true" name="dataFimVigenciaContrato"
                dateFormat="dd/mm/yy" yearRange="2000:2020"></p-calendar>
              <label>Data Final da Vigência</label>
              </span>
            </div>
            <div class = "ui-g-12" style="margin-bottom: 25px">
              <div class="ui-g">
                <div class="ui-g-12 ui-md-1">
                  <label>Ativo</label>
                </div>
                <div class="ui-g-12 ui-md-1">
                  <p-radioButton name="contrato_ativo" [value]="true" label="Sim"
                    [(ngModel)]="novoContrato.ativo"></p-radioButton>
                </div>
                <div class="ui-g-12 ui-md-2">
                  <p-radioButton name="contrato_ativo" [value]="false" label="Não"
                    [(ngModel)]="novoContrato.ativo"></p-radioButton>
                </div>
              </div>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-g-2">
              <button pButton type="button" label="Cancelar"
                (click)="fecharDialogCadastroContrato()"></button>
            </div>
            <div class="ui-g-2">
              <button pButton type="button" label="Salvar" 
                (click)="adicionarContrato()"></button>
            </div>
          </div>
        </p-dialog>

        <!-- Dialog edição contrato -->
        <p-dialog header="Contrato" [(visible)]="mostrarDialogEdicaoContrato"
          [contentStyle]="{'overflow':'visible'}" [width]="800">
          <div class="ui-g">
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <input type="text" name="numeroContrato" [(ngModel)]="contratoEmEdicao.numeroContrato" pInputText/>
                <label>Número do Contrato</label>
              </span>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <p-dropdown [options]="manuais" optionLabel="nome" placeholder="Manual"
                name="manualDropdown" [(ngModel)]="contratoEmEdicao.manual"
                [autoWidth]="false" dataKey="id"></p-dropdown>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
                <p-calendar [(ngModel)]="contratoEmEdicao.dataInicioVigencia" name="dataInicioVigenciaContrato"
                  [monthNavigator]="true" [yearNavigator]="true" 
                  dateFormat="dd/mm/yy" yearRange="2000:2020"></p-calendar>
                <label>Data de Início da Vigência</label>
              </span>
            </div>
            <div class="ui-g-6" style="margin-bottom: 25px">
              <span class="md-inputfield">
              <p-calendar [(ngModel)]="contratoEmEdicao.dataFimVigencia"
                [monthNavigator]="true" [yearNavigator]="true" name="dataFimVigenciaContrato"
                dateFormat="dd/mm/yy" yearRange="2000:2020"></p-calendar>
              <label>Data Final da Vigência</label>
              </span>
            </div>
            <div class = "ui-g-12" style="margin-bottom: 25px">
              <div class="ui-g">
                <div class="ui-g-12 ui-md-1">
                  <label>Ativo</label>
                </div>  

                <p-checkbox name="contrato_ativo" binary="true"
                  [(ngModel)]="contratoEmEdicao.ativo"></p-checkbox>
                <!-- BUG no Primeng com radiobutton dentro de dialog -->
                <!-- <div class="ui-g-12 ui-md-1">
                  <p-radioButton name="contrato_ativo" [value]="true" label="Sim"
                    [(ngModel)]="contratoEmEdicao.ativo"></p-radioButton>
                </div>
                <div class="ui-g-12 ui-md-2">
                  <p-radioButton name="contrato_ativo" [value]="false" label="Não"
                    [(ngModel)]="contratoEmEdicao.ativo"></p-radioButton>
                </div> -->
              </div>
            </div>
          </div>

          <div class="ui-g ui-md-12" style="justify-content: flex-end">
            <div class="ui-g-2">
              <button pButton type="button" label="Cancelar"
                (click)="fecharDialogEditarContrato()"></button>
            </div>
            <div class="ui-g-2">
              <button pButton type="button" label="Salvar" 
                (click)="editarContrato()"></button>
            </div>
          </div>
        </p-dialog>

      </form>
    </div>
  </div>
</div>